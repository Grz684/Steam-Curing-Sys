(function(e,v){typeof exports=="object"&&typeof module<"u"?module.exports=v(require("vue")):typeof define=="function"&&define.amd?define(["vue"],v):(e=typeof globalThis<"u"?globalThis:e||self,e.MyVueComponent=v(e.Vue))})(this,function(e){"use strict";const v=Symbol(),B=Symbol(),D=Symbol();function F(u,a){u&&u.messageSignal?u.messageSignal.connect(r=>{try{const n=JSON.parse(r);a.value=n,console.log("Received message from PyQt:",n)}catch(n){console.error("Failed to parse message:",n),a.value={type:"unknown",content:r}}}):console.error("messageSignal not found on bridge")}function U(){const u=e.ref(null),a=e.ref(null),r=e.ref("");function n(){window.QWebChannel?new QWebChannel(window.qt.webChannelTransport,o=>{u.value=o,a.value=o.objects.bridge,console.log("QWebChannel initialized",o,o.objects.bridge),F(a.value,r),a.value&&typeof a.value.vueReady=="function"?a.value.vueReady():console.error("vueReady method not found on bridge")}):console.error("QWebChannel not found")}e.onMounted(()=>{document.readyState==="complete"||document.readyState==="interactive"?n():document.addEventListener("DOMContentLoaded",n)}),e.provide(v,e.readonly(u)),e.provide(B,e.readonly(a)),e.provide(D,e.readonly(r))}function w(){const u=e.inject(v),a=e.inject(B),r=e.inject(D);return(!u||!a||!r)&&console.error("WebChannel not properly provided. Make sure to call provideWebChannel in a parent component."),{channel:u,bridge:a,message:r,sendToPyQt:(o,s)=>{if(console.log(`Attempting to call ${o} with args:`,s),a&&a.value)if(typeof a.value.sendToPyQt=="function")try{a.value.sendToPyQt(o,JSON.stringify(s))}catch(c){console.error("Error calling sendToPyQt:",c)}else console.error("Method sendToPyQt not available on bridge"),console.log("Available methods:",Object.keys(a.value));else console.error("Bridge or bridge.value is undefined")}}}const h=(u,a)=>{const r=u.__vccOpts||u;for(const[n,o]of a)r[n]=o;return r},L={key:0,class:"numeric-keyboard"},K={class:"keyboard"},I={class:"current-value"},M=["onClick"],S=h({__name:"NumericKeyboard",props:{modelValue:{type:[String,Number],default:""},showKeyboard:{type:Boolean,default:!1}},emits:["update:modelValue","update:showKeyboard"],setup(u,{emit:a}){const r=u,n=a,o=e.ref([["7","8","9"],["4","5","6"],["1","2","3"],["清除","0","确定"]]),s=e.ref("");e.watch(()=>r.showKeyboard,f=>{f&&(s.value=r.modelValue.toString())});const c=f=>{f==="清除"?s.value="":f==="确定"?(n("update:modelValue",parseFloat(s.value)||0),n("update:showKeyboard",!1)):s.value+=f};return(f,y)=>u.showKeyboard?(e.openBlock(),e.createElementBlock("div",L,[e.createElementVNode("div",K,[e.createElementVNode("div",I,e.toDisplayString(s.value),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,E=>(e.openBlock(),e.createElementBlock("div",{key:E.join(),class:"row"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(E,p=>(e.openBlock(),e.createElementBlock("button",{key:p,onClick:V=>c(p),class:e.normalizeClass({"function-key":p==="清除"||p==="确定"})},e.toDisplayString(p),11,M))),128))]))),128))])])):e.createCommentVNode("",!0)}},[["__scopeId","data-v-541feda2"]]),q={class:"settings-container"},A={class:"setting-group"},j={class:"setting-item"},z={class:"setting-controls"},R=["value"],O={class:"setting-item"},J={class:"setting-controls"},H=["value"],G={class:"setting-group"},X={class:"setting-item"},Y={class:"setting-controls"},Z=["value"],ee={class:"setting-item"},te={class:"setting-controls"},oe=["value"],ne=h({__name:"SensorSettings",setup(u){const{sendToPyQt:a}=w(),r=e.reactive({isPyQtWebEngine:!1}),n=e.ref(30),o=e.ref(10),s=e.ref(80),c=e.ref(20),f=e.ref(!1),y=e.ref(null),E=e.ref("");e.onMounted(()=>{if(r.isPyQtWebEngine=typeof window.qt<"u"&&window.qt.webChannelTransport,r.isPyQtWebEngine){console.log("在PyQt QWebEngine环境中运行");const{message:m}=w();e.watch(m,t=>{if(t&&t.type==="update_limit_settings")try{const i=JSON.parse(t.content);n.value=i.temp_upper,o.value=i.temp_lower,s.value=i.humidity_upper,c.value=i.humidity_lower,console.log("Sensor Settings updated:",i)}catch(i){console.error("Failed to parse sensor settings data:",i)}})}else console.log("在普通网页环境中运行")});const p=(m,t)=>{const i=m==="tempUpper"?n:m==="tempLower"?o:m==="humidityUpper"?s:c;i.value=(i.value||0)+t,m.startsWith("temp")?V(m==="tempUpper"?"upper":"lower"):N(m==="humidityUpper"?"upper":"lower")},V=m=>{n.value===""&&(n.value=o.value+1),o.value===""&&(o.value=n.value-1),m==="upper"?n.value=Math.max(o.value+1,n.value):o.value=Math.min(n.value-1,o.value),_()},N=m=>{s.value===""&&(s.value=c.value+1),c.value===""&&(c.value=s.value-1),m==="upper"?s.value=Math.min(100,Math.max(c.value+1,s.value)):c.value=Math.max(0,Math.min(s.value-1,c.value)),_()},_=()=>{if(n.value!==""&&o.value!==""&&s.value!==""&&c.value!==""){const m={temp_upper:n.value,temp_lower:o.value,humidity_upper:s.value,humidity_lower:c.value};console.log("设置已更新:",m),r.isPyQtWebEngine?(console.log("在PyQt QWebEngine环境中执行更新设置"),a("updateLimitSettings",m)):console.log("在普通网页环境中执行更新设置")}},b=m=>{y.value=m,f.value=!0,E.value=m.startsWith("temp")?m==="tempUpper"?n.value:o.value:m==="humidityUpper"?s.value:c.value},k=m=>{const t=parseFloat(m);isNaN(t)||(y.value==="tempUpper"?(n.value=t,V("upper")):y.value==="tempLower"?(o.value=t,V("lower")):y.value==="humidityUpper"?(s.value=t,N("upper")):y.value==="humidityLower"&&(c.value=t,N("lower"))),y.value=null};return(m,t)=>(e.openBlock(),e.createElementBlock("div",q,[e.createElementVNode("div",A,[t[15]||(t[15]=e.createElementVNode("h2",null,"温度设置 (°C)",-1)),e.createElementVNode("div",j,[t[13]||(t[13]=e.createElementVNode("span",{class:"setting-label"},"上限：",-1)),e.createElementVNode("div",z,[e.createElementVNode("button",{onClick:t[0]||(t[0]=i=>p("tempUpper",-1))},"-"),e.createElementVNode("input",{type:"text",value:n.value,onFocus:t[1]||(t[1]=i=>b("tempUpper")),readonly:""},null,40,R),e.createElementVNode("button",{onClick:t[2]||(t[2]=i=>p("tempUpper",1))},"+")])]),e.createElementVNode("div",O,[t[14]||(t[14]=e.createElementVNode("span",{class:"setting-label"},"下限：",-1)),e.createElementVNode("div",J,[e.createElementVNode("button",{onClick:t[3]||(t[3]=i=>p("tempLower",-1))},"-"),e.createElementVNode("input",{type:"text",value:o.value,onFocus:t[4]||(t[4]=i=>b("tempLower")),readonly:""},null,40,H),e.createElementVNode("button",{onClick:t[5]||(t[5]=i=>p("tempLower",1))},"+")])])]),e.createElementVNode("div",G,[t[18]||(t[18]=e.createElementVNode("h2",null,"湿度设置 (%)",-1)),e.createElementVNode("div",X,[t[16]||(t[16]=e.createElementVNode("span",{class:"setting-label"},"上限：",-1)),e.createElementVNode("div",Y,[e.createElementVNode("button",{onClick:t[6]||(t[6]=i=>p("humidityUpper",-1))},"-"),e.createElementVNode("input",{type:"text",value:s.value,onFocus:t[7]||(t[7]=i=>b("humidityUpper")),readonly:""},null,40,Z),e.createElementVNode("button",{onClick:t[8]||(t[8]=i=>p("humidityUpper",1))},"+")])]),e.createElementVNode("div",ee,[t[17]||(t[17]=e.createElementVNode("span",{class:"setting-label"},"下限：",-1)),e.createElementVNode("div",te,[e.createElementVNode("button",{onClick:t[9]||(t[9]=i=>p("humidityLower",-1))},"-"),e.createElementVNode("input",{type:"text",value:c.value,onFocus:t[10]||(t[10]=i=>b("humidityLower")),readonly:""},null,40,oe),e.createElementVNode("button",{onClick:t[11]||(t[11]=i=>p("humidityLower",1))},"+")])])]),e.createVNode(S,{modelValue:E.value,showKeyboard:f.value,"onUpdate:modelValue":k,"onUpdate:showKeyboard":t[12]||(t[12]=i=>f.value=i)},null,8,["modelValue","showKeyboard"])]))}},[["__scopeId","data-v-22394ea0"]]),le={class:"sensor-data-group"},se={class:"sensor-section"},ae={class:"sensor-container"},re={class:"sensor-grid"},ie={class:"sensor-title"},de={class:"sensor-value"},ce={class:"sensor-section"},me={class:"sensor-container"},pe={class:"sensor-grid"},ue={class:"sensor-title"},ye={class:"sensor-value"},fe=h({__name:"SensorDisplay",setup(u){const a=e.ref({temperature:{},humidity:{}});e.onMounted(()=>{if(typeof window.qt<"u"&&window.qt.webChannelTransport){console.log("在PyQt QWebEngine环境中执行");const{message:n}=w();e.watch(n,o=>{if(o&&o.type==="update_sensor_data")try{a.value=JSON.parse(o.content)}catch(s){console.error("Failed to parse sensor data:",s)}})}else console.log("在普通网页环境中执行"),r(),setInterval(r,5e3)});const r=async()=>{try{const n=await fetch("http://localhost:8000/api/sensor-data/");if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const o=await n.json();a.value=o}catch(n){console.error("Error fetching sensor data:",n)}};return(n,o)=>(e.openBlock(),e.createElementBlock("div",le,[e.createElementVNode("div",se,[o[0]||(o[0]=e.createElementVNode("h2",null,"温度传感器",-1)),e.createElementVNode("div",ae,[e.createElementVNode("div",re,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value.temperature,(s,c)=>(e.openBlock(),e.createElementBlock("div",{key:c,class:"sensor-card"},[e.createElementVNode("div",ie,e.toDisplayString(c),1),e.createElementVNode("div",de,e.toDisplayString(s),1)]))),128))])])]),e.createElementVNode("div",ce,[o[1]||(o[1]=e.createElementVNode("h2",null,"湿度传感器",-1)),e.createElementVNode("div",me,[e.createElementVNode("div",pe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value.humidity,(s,c)=>(e.openBlock(),e.createElementBlock("div",{key:c,class:"sensor-card"},[e.createElementVNode("div",ue,e.toDisplayString(c),1),e.createElementVNode("div",ye,e.toDisplayString(s),1)]))),128))])])])]))}},[["__scopeId","data-v-947b9192"]]),ge={class:"cart-system"},Ee={class:"water-protection"},_e={class:"mode-group"},be={class:"mode-content"},Ve={key:0},Ne={class:"controls"},ve={class:"input-group"},we={class:"input-group"},he={class:"button-group"},ke=["disabled"],$e=["disabled"],Se={class:"visualization"},Ce={class:"progress-bar"},Qe={class:"status"},Be={key:1,class:"auto-mode-container"},De=h({__name:"CartSystem",setup(u){const a=e.ref("semi-auto"),r=e.ref(6),n=e.ref(12),o=e.ref(r.value),s=e.ref(n.value),c=e.ref(r.value),f=e.ref(n.value),y=e.ref(!1),E=e.ref(0),p=e.ref("系统就绪"),V=e.ref("小车尚未工作"),N=e.ref(!1),_=e.ref(!1);let b=null;const k=e.ref(!1),m=e.ref(!1),{sendToPyQt:t}=w(),i=e.reactive({isPyQtWebEngine:!1});e.onMounted(()=>{if(i.isPyQtWebEngine=typeof window.qt<"u"&&window.qt.webChannelTransport,i.isPyQtWebEngine){console.log("在PyQt QWebEngine环境中运行");const{message:g}=w();e.watch(g,l=>{if(l&&l.type==="update_dolly_settings")try{const d=JSON.parse(l.content);o.value=d.dolly_single_run_time,s.value=d.dolly_run_interval_time,c.value=o.value,f.value=s.value,console.log("dolly Settings updated:",d)}catch(d){console.error("Failed to parse dolly settings data:",d)}else if(l&&l.type==="update_dolly_state")l.content?Q("小车正在运行"):Q("小车尚未工作");else if(l&&l.type==="update_water_tank_status")try{const d=JSON.parse(l.content);d.side==="left"?k.value=d.low_water:d.side==="right"&&(m.value=d.low_water),console.log("Water tank status updated:",d)}catch(d){console.error("Failed to parse water tank status data:",d)}})}else console.log("在普通网页环境中运行")});const W=g=>{a.value=g,i.isPyQtWebEngine&&(g==="auto"?(T(),t("controlDolly",{target:"setMode",mode:"auto"})):(C(),Q("小车尚未工作"),t("controlDolly",{target:"setMode",mode:"semi-auto"})))},Le=()=>{o.value=Math.max(1,parseInt(o.value)||1),c.value=o.value,P()},Ke=()=>{s.value=Math.max(0,parseInt(s.value)||0),f.value=s.value,P()};function P(){if(i.isPyQtWebEngine){console.log("在PyQt QWebEngine环境中执行更新设置");const g={target:"dolly_settings",dolly_single_run_time:c.value,dolly_run_interval_time:f.value};t("controlDolly",g)}else console.log("在普通网页环境中执行更新设置")}const Ie=()=>{y.value=!0,x()},T=()=>{C(),y.value=!1,cancelAnimationFrame(b),E.value=0,p.value="系统就绪"};function C(){i.isPyQtWebEngine?(console.log("在PyQt QWebEngine环境中执行更新设置"),t("controlDolly",{target:"setState",dolly_state:!1})):console.log("在普通网页环境中执行更新设置")}function Me(){i.isPyQtWebEngine?(console.log("在PyQt QWebEngine环境中执行更新设置"),t("controlDolly",{target:"setState",dolly_state:!0})):console.log("在普通网页环境中执行更新设置")}const x=()=>{Me(),p.value="小车运行中",E.value=0;const g=Date.now();r.value=c.value;const l=()=>{const d=(Date.now()-g)/1e3,$=Math.max(0,r.value-d);E.value=d/r.value*100,p.value=`小车运行中: 剩余 ${$.toFixed(1)} 秒`,d<r.value&&y.value?b=requestAnimationFrame(l):y.value&&(E.value=100,C(),qe())};b=requestAnimationFrame(l)},qe=()=>{p.value="等待下次运行";const g=Date.now();n.value=f.value;const l=()=>{const d=(Date.now()-g)/1e3,$=Math.max(0,n.value-d);p.value=`等待下次运行: ${$.toFixed(1)}秒`,$>0&&y.value?b=requestAnimationFrame(l):y.value&&x()};b=requestAnimationFrame(l)},Q=g=>{V.value=g};return e.onUnmounted(()=>{cancelAnimationFrame(b)}),(g,l)=>(e.openBlock(),e.createElementBlock("div",ge,[e.createElementVNode("div",Ee,[e.createElementVNode("div",{class:e.normalizeClass(["water-tank",{"low-water":k.value}])}," 左水箱: "+e.toDisplayString(k.value?"缺水":"正常"),3),e.createElementVNode("div",{class:e.normalizeClass(["water-tank",{"low-water":m.value}])}," 右水箱: "+e.toDisplayString(m.value?"缺水":"正常"),3)]),e.createElementVNode("div",_e,[e.createElementVNode("button",{class:e.normalizeClass(["mode-button",{active:a.value==="semi-auto"}]),onClick:l[0]||(l[0]=d=>a.value==="auto"?W("semi-auto"):()=>{})},"半自动模式",2),e.createElementVNode("button",{class:e.normalizeClass(["mode-button",{active:a.value==="auto"}]),onClick:l[1]||(l[1]=d=>a.value==="semi-auto"?W("auto"):()=>{})},"自动模式",2)]),e.createElementVNode("div",be,[a.value==="semi-auto"?(e.openBlock(),e.createElementBlock("div",Ve,[e.createElementVNode("div",Ne,[e.createElementVNode("div",ve,[l[8]||(l[8]=e.createElementVNode("label",null,"单次运行时间 (秒):",-1)),e.createElementVNode("div",{class:"input-wrapper",onClick:l[2]||(l[2]=d=>N.value=!0)},e.toDisplayString(o.value),1)]),e.createElementVNode("div",we,[l[9]||(l[9]=e.createElementVNode("label",null,"循环间隔时间 (秒):",-1)),e.createElementVNode("div",{class:"input-wrapper",onClick:l[3]||(l[3]=d=>_.value=!0)},e.toDisplayString(s.value),1)]),e.createElementVNode("div",he,[e.createElementVNode("button",{onClick:Ie,disabled:y.value},"开始",8,ke),e.createElementVNode("button",{onClick:T,disabled:!y.value},"停止",8,$e)])]),e.createElementVNode("div",Se,[e.createElementVNode("div",Ce,[e.createElementVNode("div",{class:"progress",style:e.normalizeStyle({width:E.value+"%"})},null,4),e.createElementVNode("div",{class:"cart",style:e.normalizeStyle({left:E.value+"%"})},l[10]||(l[10]=[e.createElementVNode("span",{class:"cart-icon"},"🚜",-1)]),4)])]),e.createElementVNode("div",Qe,e.toDisplayString(p.value),1)])):(e.openBlock(),e.createElementBlock("div",Be,[l[11]||(l[11]=e.createElementVNode("div",{class:"auto-mode-title"},"自动模式受传感器湿度控制",-1)),e.createElementVNode("div",{class:e.normalizeClass(["auto-mode-status",{working:V.value==="小车正在运行"}])},e.toDisplayString(V.value),3),l[12]||(l[12]=e.createElementVNode("div",{class:"auto-mode-placeholder"},null,-1))]))]),e.createVNode(S,{modelValue:o.value,"onUpdate:modelValue":[l[4]||(l[4]=d=>o.value=d),Le],showKeyboard:N.value,"onUpdate:showKeyboard":l[5]||(l[5]=d=>N.value=d)},null,8,["modelValue","showKeyboard"]),e.createVNode(S,{modelValue:s.value,"onUpdate:modelValue":[l[6]||(l[6]=d=>s.value=d),Ke],showKeyboard:_.value,"onUpdate:showKeyboard":l[7]||(l[7]=d=>_.value=d)},null,8,["modelValue","showKeyboard"])]))}},[["__scopeId","data-v-79e5d674"]]),We={class:"data-actions"},Pe={key:0,class:"modal-overlay"},Te={key:1,class:"modal-overlay"},xe={class:"modal-content"},Fe=h({__name:"DataExport",setup(u){const{sendToPyQt:a}=w(),r=e.reactive({isPyQtWebEngine:!1}),n=e.ref(!1),o=e.ref(!1),s=e.ref("");e.onMounted(()=>{r.isPyQtWebEngine=typeof window.qt<"u"&&window.qt.webChannelTransport,r.isPyQtWebEngine?console.log("在PyQt QWebEngine环境中运行"):console.log("在普通网页环境中运行")});const c=()=>{r.isPyQtWebEngine&&(console.log("导出数据"),a("exportData",!0))},f=()=>{n.value=!0},y=()=>{n.value=!1},E=()=>{console.log("清空数据"),n.value=!1,p("所有数据已清空！"),r.isPyQtWebEngine&&a("exportData",!1)},p=N=>{s.value=N,o.value=!0},V=()=>{o.value=!1};return(N,_)=>(e.openBlock(),e.createElementBlock("div",We,[e.createElementVNode("div",{class:"action-buttons"},[e.createElementVNode("div",{class:"button-group"},[_[0]||(_[0]=e.createElementVNode("i",{class:"fas fa-file-excel"},null,-1)),e.createElementVNode("button",{onClick:c,class:"export-btn"},"导出数据")]),e.createElementVNode("div",{class:"button-group"},[_[1]||(_[1]=e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)),e.createElementVNode("button",{onClick:f,class:"clear-btn"},"清空数据")])]),n.value?(e.openBlock(),e.createElementBlock("div",Pe,[e.createElementVNode("div",{class:"modal-content"},[_[2]||(_[2]=e.createElementVNode("p",null,"确定要清空所有数据吗？此操作不可撤销。",-1)),e.createElementVNode("div",{class:"modal-buttons"},[e.createElementVNode("button",{onClick:E,class:"confirm-btn"},"确定"),e.createElementVNode("button",{onClick:y,class:"cancel-btn"},"取消")])])])):e.createCommentVNode("",!0),o.value?(e.openBlock(),e.createElementBlock("div",Te,[e.createElementVNode("div",xe,[e.createElementVNode("p",null,e.toDisplayString(s.value),1),e.createElementVNode("div",{class:"modal-buttons"},[e.createElementVNode("button",{onClick:V,class:"confirm-btn"},"确定")])])])):e.createCommentVNode("",!0)]))}},[["__scopeId","data-v-86824edf"]]),Ue={class:"settings-container"};return{__name:"App",setup(u){return U(),(a,r)=>(e.openBlock(),e.createElementBlock("div",Ue,[r[0]||(r[0]=e.createElementVNode("h1",null,"涪特智能养护台车控制系统",-1)),e.createVNode(fe),e.createVNode(Fe),e.createVNode(ne),e.createVNode(De)]))}}});
