(function(e,w){typeof exports=="object"&&typeof module<"u"?module.exports=w(require("vue")):typeof define=="function"&&define.amd?define(["vue"],w):(e=typeof globalThis<"u"?globalThis:e||self,e.MyVueComponent=w(e.Vue))})(this,function(e){"use strict";const w=Symbol(),W=Symbol(),P=Symbol();function U(p,s){p&&p.messageSignal?p.messageSignal.connect(r=>{try{const n=JSON.parse(r);s.value=n,console.log("Received message from PyQt:",n)}catch(n){console.error("Failed to parse message:",n),s.value={type:"unknown",content:r}}}):console.error("messageSignal not found on bridge")}function L(){const p=e.ref(null),s=e.ref(null),r=e.ref("");function n(){window.QWebChannel?new QWebChannel(window.qt.webChannelTransport,o=>{p.value=o,s.value=o.objects.bridge,console.log("QWebChannel initialized",o,o.objects.bridge),U(s.value,r),s.value&&typeof s.value.vueReady=="function"?s.value.vueReady():console.error("vueReady method not found on bridge")}):console.error("QWebChannel not found")}e.onMounted(()=>{document.readyState==="complete"||document.readyState==="interactive"?n():document.addEventListener("DOMContentLoaded",n)}),e.provide(w,e.readonly(p)),e.provide(W,e.readonly(s)),e.provide(P,e.readonly(r))}function h(){const p=e.inject(w),s=e.inject(W),r=e.inject(P);return(!p||!s||!r)&&console.error("WebChannel not properly provided. Make sure to call provideWebChannel in a parent component."),{channel:p,bridge:s,message:r,sendToPyQt:(o,a)=>{if(console.log(`Attempting to call ${o} with args:`,a),s&&s.value)if(typeof s.value.sendToPyQt=="function")try{s.value.sendToPyQt(o,JSON.stringify(a))}catch(c){console.error("Error calling sendToPyQt:",c)}else console.error("Method sendToPyQt not available on bridge"),console.log("Available methods:",Object.keys(s.value));else console.error("Bridge or bridge.value is undefined")}}}const $=(p,s)=>{const r=p.__vccOpts||p;for(const[n,o]of s)r[n]=o;return r},K={key:0,class:"numeric-keyboard"},I={class:"keyboard"},M={class:"current-value"},q=["onClick"],D=$({__name:"NumericKeyboard",props:{modelValue:{type:[String,Number],default:""},showKeyboard:{type:Boolean,default:!1}},emits:["update:modelValue","update:showKeyboard"],setup(p,{emit:s}){const r=p,n=s,o=e.ref([["7","8","9"],["4","5","6"],["1","2","3"],["清除","0","确定"]]),a=e.ref("");e.watch(()=>r.showKeyboard,y=>{y&&(a.value=r.modelValue.toString())});const c=y=>{y==="清除"?a.value="":y==="确定"?(n("update:modelValue",parseFloat(a.value)||0),n("update:showKeyboard",!1)):a.value+=y};return(y,f)=>p.showKeyboard?(e.openBlock(),e.createElementBlock("div",K,[e.createElementVNode("div",I,[e.createElementVNode("div",M,e.toDisplayString(a.value),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,_=>(e.openBlock(),e.createElementBlock("div",{key:_.join(),class:"row"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(_,u=>(e.openBlock(),e.createElementBlock("button",{key:u,onClick:V=>c(u),class:e.normalizeClass({"function-key":u==="清除"||u==="确定"})},e.toDisplayString(u),11,q))),128))]))),128))])])):e.createCommentVNode("",!0)}},[["__scopeId","data-v-541feda2"]]),A={class:"settings-container"},j={class:"setting-group"},z={class:"setting-item"},R={class:"setting-controls"},O=["value"],J={class:"setting-item"},H={class:"setting-controls"},G=["value"],X={class:"setting-group"},Y={class:"setting-item"},Z={class:"setting-controls"},ee=["value"],te={class:"setting-item"},oe={class:"setting-controls"},ne=["value"],le=$({__name:"SensorSettings",setup(p){const{sendToPyQt:s}=h(),r=e.reactive({isPyQtWebEngine:!1}),n=e.ref(30),o=e.ref(10),a=e.ref(80),c=e.ref(20),y=e.ref(!1),f=e.ref(null),_=e.ref("");e.onMounted(()=>{if(r.isPyQtWebEngine=typeof window.qt<"u"&&window.qt.webChannelTransport,r.isPyQtWebEngine){console.log("在PyQt QWebEngine环境中运行");const{message:m}=h();e.watch(m,t=>{if(t&&t.type==="update_limit_settings")try{const i=JSON.parse(t.content);n.value=i.temp_upper,o.value=i.temp_lower,a.value=i.humidity_upper,c.value=i.humidity_lower,console.log("Sensor Settings updated:",i)}catch(i){console.error("Failed to parse sensor settings data:",i)}})}else console.log("在普通网页环境中运行")});const u=(m,t)=>{const i=m==="tempUpper"?n:m==="tempLower"?o:m==="humidityUpper"?a:c;i.value=(i.value||0)+t,m.startsWith("temp")?V(m==="tempUpper"?"upper":"lower"):N(m==="humidityUpper"?"upper":"lower")},V=m=>{n.value===""&&(n.value=o.value+1),o.value===""&&(o.value=n.value-1),m==="upper"?n.value=Math.max(o.value+1,n.value):o.value=Math.min(n.value-1,o.value),E()},N=m=>{a.value===""&&(a.value=c.value+1),c.value===""&&(c.value=a.value-1),m==="upper"?a.value=Math.min(100,Math.max(c.value+1,a.value)):c.value=Math.max(0,Math.min(a.value-1,c.value)),E()},E=()=>{if(n.value!==""&&o.value!==""&&a.value!==""&&c.value!==""){const m={temp_upper:n.value,temp_lower:o.value,humidity_upper:a.value,humidity_lower:c.value};console.log("设置已更新:",m),r.isPyQtWebEngine?(console.log("在PyQt QWebEngine环境中执行更新设置"),s("updateLimitSettings",m)):console.log("在普通网页环境中执行更新设置")}},b=m=>{f.value=m,y.value=!0,_.value=m.startsWith("temp")?m==="tempUpper"?n.value:o.value:m==="humidityUpper"?a.value:c.value},v=m=>{const t=parseFloat(m);isNaN(t)||(f.value==="tempUpper"?(n.value=t,V("upper")):f.value==="tempLower"?(o.value=t,V("lower")):f.value==="humidityUpper"?(a.value=t,N("upper")):f.value==="humidityLower"&&(c.value=t,N("lower"))),f.value=null};return(m,t)=>(e.openBlock(),e.createElementBlock("div",A,[e.createElementVNode("div",j,[t[15]||(t[15]=e.createElementVNode("h2",null,"温度设置 (°C)",-1)),e.createElementVNode("div",z,[t[13]||(t[13]=e.createElementVNode("span",{class:"setting-label"},"上限：",-1)),e.createElementVNode("div",R,[e.createElementVNode("button",{onClick:t[0]||(t[0]=i=>u("tempUpper",-1))},"-"),e.createElementVNode("input",{type:"text",value:n.value,onFocus:t[1]||(t[1]=i=>b("tempUpper")),readonly:""},null,40,O),e.createElementVNode("button",{onClick:t[2]||(t[2]=i=>u("tempUpper",1))},"+")])]),e.createElementVNode("div",J,[t[14]||(t[14]=e.createElementVNode("span",{class:"setting-label"},"下限：",-1)),e.createElementVNode("div",H,[e.createElementVNode("button",{onClick:t[3]||(t[3]=i=>u("tempLower",-1))},"-"),e.createElementVNode("input",{type:"text",value:o.value,onFocus:t[4]||(t[4]=i=>b("tempLower")),readonly:""},null,40,G),e.createElementVNode("button",{onClick:t[5]||(t[5]=i=>u("tempLower",1))},"+")])])]),e.createElementVNode("div",X,[t[18]||(t[18]=e.createElementVNode("h2",null,"湿度设置 (%)",-1)),e.createElementVNode("div",Y,[t[16]||(t[16]=e.createElementVNode("span",{class:"setting-label"},"上限：",-1)),e.createElementVNode("div",Z,[e.createElementVNode("button",{onClick:t[6]||(t[6]=i=>u("humidityUpper",-1))},"-"),e.createElementVNode("input",{type:"text",value:a.value,onFocus:t[7]||(t[7]=i=>b("humidityUpper")),readonly:""},null,40,ee),e.createElementVNode("button",{onClick:t[8]||(t[8]=i=>u("humidityUpper",1))},"+")])]),e.createElementVNode("div",te,[t[17]||(t[17]=e.createElementVNode("span",{class:"setting-label"},"下限：",-1)),e.createElementVNode("div",oe,[e.createElementVNode("button",{onClick:t[9]||(t[9]=i=>u("humidityLower",-1))},"-"),e.createElementVNode("input",{type:"text",value:c.value,onFocus:t[10]||(t[10]=i=>b("humidityLower")),readonly:""},null,40,ne),e.createElementVNode("button",{onClick:t[11]||(t[11]=i=>u("humidityLower",1))},"+")])])]),e.createVNode(D,{modelValue:_.value,showKeyboard:y.value,"onUpdate:modelValue":v,"onUpdate:showKeyboard":t[12]||(t[12]=i=>y.value=i)},null,8,["modelValue","showKeyboard"])]))}},[["__scopeId","data-v-22394ea0"]]),se={class:"sensor-data-group"},ae={class:"sensor-section"},re={class:"sensor-container"},ie={class:"sensor-grid"},de={class:"sensor-title"},ce={class:"sensor-value"},me={class:"sensor-section"},ue={class:"sensor-container"},pe={class:"sensor-grid"},fe={class:"sensor-title"},ye={class:"sensor-value"},ge=$({__name:"SensorDisplay",setup(p){const s=e.ref({temperature:{},humidity:{}});e.onMounted(()=>{if(typeof window.qt<"u"&&window.qt.webChannelTransport){console.log("在PyQt QWebEngine环境中执行");const{message:n}=h();e.watch(n,o=>{if(o&&o.type==="update_sensor_data")try{s.value=JSON.parse(o.content)}catch(a){console.error("Failed to parse sensor data:",a)}})}else console.log("在普通网页环境中执行"),r(),setInterval(r,5e3)});const r=async()=>{try{const n=await fetch("http://localhost:8000/api/sensor-data/");if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const o=await n.json();s.value=o}catch(n){console.error("Error fetching sensor data:",n)}};return(n,o)=>(e.openBlock(),e.createElementBlock("div",se,[e.createElementVNode("div",ae,[o[0]||(o[0]=e.createElementVNode("h2",null,"温度传感器",-1)),e.createElementVNode("div",re,[e.createElementVNode("div",ie,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value.temperature,(a,c)=>(e.openBlock(),e.createElementBlock("div",{key:c,class:"sensor-card"},[e.createElementVNode("div",de,e.toDisplayString(c),1),e.createElementVNode("div",ce,e.toDisplayString(a),1)]))),128))])])]),e.createElementVNode("div",me,[o[1]||(o[1]=e.createElementVNode("h2",null,"湿度传感器",-1)),e.createElementVNode("div",ue,[e.createElementVNode("div",pe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value.humidity,(a,c)=>(e.openBlock(),e.createElementBlock("div",{key:c,class:"sensor-card"},[e.createElementVNode("div",fe,e.toDisplayString(c),1),e.createElementVNode("div",ye,e.toDisplayString(a),1)]))),128))])])])]))}},[["__scopeId","data-v-39bdb13c"]]),_e={class:"cart-system"},Ee={class:"water-protection"},be={class:"mode-group"},Ve=["disabled"],Ne=["disabled"],ve={class:"mode-content"},we={key:0},he={class:"controls"},ke={class:"input-group"},$e={class:"input-group"},Se={class:"button-group"},Ce=["disabled"],Qe=["disabled"],De={class:"visualization"},Be={class:"progress-bar"},We={class:"status"},Pe={key:1,class:"auto-mode-container"},Te=$({__name:"CartSystem",setup(p){const s=e.ref("semi-auto"),r=e.ref(6),n=e.ref(12),o=e.ref(r.value),a=e.ref(n.value),c=e.ref(r.value),y=e.ref(n.value),f=e.ref(!1),_=e.ref(0),u=e.ref("系统就绪"),V=e.ref("小车尚未工作"),N=e.ref(!1),E=e.ref(!1),b=e.ref(!1);let v=null;const m=e.ref(!1),t=e.ref(!1),{sendToPyQt:i}=h(),k=e.reactive({isPyQtWebEngine:!1});e.onMounted(()=>{if(k.isPyQtWebEngine=typeof window.qt<"u"&&window.qt.webChannelTransport,k.isPyQtWebEngine){console.log("在PyQt QWebEngine环境中运行");const{message:g}=h();e.watch(g,l=>{if(l&&l.type==="update_dolly_settings")try{const d=JSON.parse(l.content);o.value=d.dolly_single_run_time,a.value=d.dolly_run_interval_time,c.value=o.value,y.value=a.value,console.log("dolly Settings updated:",d)}catch(d){console.error("Failed to parse dolly settings data:",d)}else if(l&&l.type==="update_dolly_state")l.content?C("小车正在运行"):C("小车尚未工作");else if(l&&l.type==="update_water_tank_status")try{const d=JSON.parse(l.content);d.side==="left"?m.value=d.low_water:d.side==="right"&&(t.value=d.low_water),m.value||t.value?(b.value=!0,s.value==="auto"?(C("小车尚未工作"),i("controlDolly",{target:"setMode",mode:"semi-auto"}),S()):B()):(b.value=!1,s.value==="auto"&&i("controlDolly",{target:"setMode",mode:"auto"})),console.log("Water tank status updated:",d)}catch(d){console.error("Failed to parse water tank status data:",d)}})}else console.log("在普通网页环境中运行")});const T=g=>{s.value=g,k.isPyQtWebEngine&&(g==="auto"?(B(),i("controlDolly",{target:"setMode",mode:"auto"})):(S(),C("小车尚未工作"),i("controlDolly",{target:"setMode",mode:"semi-auto"})))},Me=()=>{o.value=Math.max(1,parseInt(o.value)||1),c.value=o.value,x()},qe=()=>{a.value=Math.max(0,parseInt(a.value)||0),y.value=a.value,x()};function x(){if(k.isPyQtWebEngine){console.log("在PyQt QWebEngine环境中执行更新设置");const g={target:"dolly_settings",dolly_single_run_time:c.value,dolly_run_interval_time:y.value};i("controlDolly",g)}else console.log("在普通网页环境中执行更新设置")}const Ae=()=>{f.value=!0,F()},B=()=>{S(),f.value=!1,cancelAnimationFrame(v),_.value=0,u.value="系统就绪"};function S(){k.isPyQtWebEngine?(console.log("在PyQt QWebEngine环境中执行更新设置"),i("controlDolly",{target:"setState",dolly_state:!1})):console.log("在普通网页环境中执行更新设置")}function je(){k.isPyQtWebEngine?(console.log("在PyQt QWebEngine环境中执行更新设置"),i("controlDolly",{target:"setState",dolly_state:!0})):console.log("在普通网页环境中执行更新设置")}const F=()=>{je(),u.value="小车运行中",_.value=0;const g=Date.now();r.value=c.value;const l=()=>{const d=(Date.now()-g)/1e3,Q=Math.max(0,r.value-d);_.value=d/r.value*100,u.value=`小车运行中: 剩余 ${Q.toFixed(1)} 秒`,d<r.value&&f.value?v=requestAnimationFrame(l):f.value&&(_.value=100,S(),ze())};v=requestAnimationFrame(l)},ze=()=>{u.value="等待下次运行";const g=Date.now();n.value=y.value;const l=()=>{const d=(Date.now()-g)/1e3,Q=Math.max(0,n.value-d);u.value=`等待下次运行: ${Q.toFixed(1)}秒`,Q>0&&f.value?v=requestAnimationFrame(l):f.value&&F()};v=requestAnimationFrame(l)},C=g=>{V.value=g};return e.onUnmounted(()=>{cancelAnimationFrame(v)}),(g,l)=>(e.openBlock(),e.createElementBlock("div",_e,[e.createElementVNode("div",Ee,[e.createElementVNode("div",{class:e.normalizeClass(["water-tank",{"low-water":m.value}])}," 左水箱: "+e.toDisplayString(m.value?"缺水":"正常"),3),e.createElementVNode("div",{class:e.normalizeClass(["water-tank",{"low-water":t.value}])}," 右水箱: "+e.toDisplayString(t.value?"缺水":"正常"),3)]),e.createElementVNode("div",be,[e.createElementVNode("button",{class:e.normalizeClass(["mode-button",{active:s.value==="semi-auto"&&!b.value}]),disabled:b.value,onClick:l[0]||(l[0]=d=>s.value==="auto"?T("semi-auto"):()=>{})},"半自动模式",10,Ve),e.createElementVNode("button",{class:e.normalizeClass(["mode-button",{active:s.value==="auto"&&!b.value}]),disabled:b.value,onClick:l[1]||(l[1]=d=>s.value==="semi-auto"?T("auto"):()=>{})},"自动模式",10,Ne)]),e.createElementVNode("div",ve,[s.value==="semi-auto"?(e.openBlock(),e.createElementBlock("div",we,[e.createElementVNode("div",he,[e.createElementVNode("div",ke,[l[8]||(l[8]=e.createElementVNode("label",null,"单次运行时间 (秒):",-1)),e.createElementVNode("div",{class:"input-wrapper",onClick:l[2]||(l[2]=d=>N.value=!0)},e.toDisplayString(o.value),1)]),e.createElementVNode("div",$e,[l[9]||(l[9]=e.createElementVNode("label",null,"循环间隔时间 (秒):",-1)),e.createElementVNode("div",{class:"input-wrapper",onClick:l[3]||(l[3]=d=>E.value=!0)},e.toDisplayString(a.value),1)]),e.createElementVNode("div",Se,[e.createElementVNode("button",{onClick:Ae,disabled:f.value||b.value},"开始",8,Ce),e.createElementVNode("button",{onClick:B,disabled:!f.value||b.value},"停止",8,Qe)])]),e.createElementVNode("div",De,[e.createElementVNode("div",Be,[e.createElementVNode("div",{class:"progress",style:e.normalizeStyle({width:_.value+"%"})},null,4),e.createElementVNode("div",{class:"cart",style:e.normalizeStyle({left:_.value+"%"})},l[10]||(l[10]=[e.createElementVNode("span",{class:"cart-icon"},"🚜",-1)]),4)])]),e.createElementVNode("div",We,e.toDisplayString(u.value),1)])):(e.openBlock(),e.createElementBlock("div",Pe,[l[11]||(l[11]=e.createElementVNode("div",{class:"auto-mode-title"},"自动模式受传感器湿度控制",-1)),e.createElementVNode("div",{class:e.normalizeClass(["auto-mode-status",{working:V.value==="小车正在运行"}])},e.toDisplayString(V.value),3),l[12]||(l[12]=e.createElementVNode("div",{class:"auto-mode-placeholder"},null,-1))]))]),e.createVNode(D,{modelValue:o.value,"onUpdate:modelValue":[l[4]||(l[4]=d=>o.value=d),Me],showKeyboard:N.value,"onUpdate:showKeyboard":l[5]||(l[5]=d=>N.value=d)},null,8,["modelValue","showKeyboard"]),e.createVNode(D,{modelValue:a.value,"onUpdate:modelValue":[l[6]||(l[6]=d=>a.value=d),qe],showKeyboard:E.value,"onUpdate:showKeyboard":l[7]||(l[7]=d=>E.value=d)},null,8,["modelValue","showKeyboard"])]))}},[["__scopeId","data-v-b48d851a"]]),xe={class:"data-actions"},Fe={key:0,class:"modal-overlay"},Ue={key:1,class:"modal-overlay"},Le={class:"modal-content"},Ke=$({__name:"DataExport",setup(p){const{sendToPyQt:s}=h(),r=e.reactive({isPyQtWebEngine:!1}),n=e.ref(!1),o=e.ref(!1),a=e.ref("");e.onMounted(()=>{r.isPyQtWebEngine=typeof window.qt<"u"&&window.qt.webChannelTransport,r.isPyQtWebEngine?console.log("在PyQt QWebEngine环境中运行"):console.log("在普通网页环境中运行")});const c=()=>{r.isPyQtWebEngine&&(console.log("导出数据"),s("exportData",!0))},y=()=>{n.value=!0},f=()=>{n.value=!1},_=()=>{console.log("清空数据"),n.value=!1,u("所有数据已清空！"),r.isPyQtWebEngine&&s("exportData",!1)},u=N=>{a.value=N,o.value=!0},V=()=>{o.value=!1};return(N,E)=>(e.openBlock(),e.createElementBlock("div",xe,[e.createElementVNode("div",{class:"action-buttons"},[e.createElementVNode("div",{class:"button-group"},[E[0]||(E[0]=e.createElementVNode("i",{class:"fas fa-file-excel"},null,-1)),e.createElementVNode("button",{onClick:c,class:"export-btn"},"导出数据")]),e.createElementVNode("div",{class:"button-group"},[E[1]||(E[1]=e.createElementVNode("i",{class:"fas fa-trash-alt"},null,-1)),e.createElementVNode("button",{onClick:y,class:"clear-btn"},"清空数据")])]),n.value?(e.openBlock(),e.createElementBlock("div",Fe,[e.createElementVNode("div",{class:"modal-content"},[E[2]||(E[2]=e.createElementVNode("p",null,"确定要清空所有数据吗？此操作不可撤销。",-1)),e.createElementVNode("div",{class:"modal-buttons"},[e.createElementVNode("button",{onClick:_,class:"confirm-btn"},"确定"),e.createElementVNode("button",{onClick:f,class:"cancel-btn"},"取消")])])])):e.createCommentVNode("",!0),o.value?(e.openBlock(),e.createElementBlock("div",Ue,[e.createElementVNode("div",Le,[e.createElementVNode("p",null,e.toDisplayString(a.value),1),e.createElementVNode("div",{class:"modal-buttons"},[e.createElementVNode("button",{onClick:V,class:"confirm-btn"},"确定")])])])):e.createCommentVNode("",!0)]))}},[["__scopeId","data-v-86824edf"]]),Ie={class:"settings-container"};return{__name:"App",setup(p){return L(),(s,r)=>(e.openBlock(),e.createElementBlock("div",Ie,[r[0]||(r[0]=e.createElementVNode("h1",null,"涪特智能养护台车控制系统",-1)),e.createVNode(ge),e.createVNode(Ke),e.createVNode(le),e.createVNode(Te)]))}}});
